# Production .htaccess â€” allow public traffic
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
# --- HMQZ: staging noindex ---
<IfModule mod_headers.c>
  Header set X-Robots-Tag "noindex, nofollow, noarchive"
</IfModule>
# -----------------------------
# --- HMQZ: CSP Report-Only for STAGING (telemetry only) ---
<IfModule mod_headers.c>
  # Ensure no enforcing CSP on staging; let PHP/plugins add nothing enforcing here.
  Header always unset Content-Security-Policy
  Header always unset Content-Security-Policy-Report-Only

  # Modern reporting (Report-To / Reporting-Endpoints); replace the URL with your collector
  Header always set Report-To "{ \"group\": \"csp-endpoint\", \"max_age\": 10886400, \"endpoints\": [{ \"url\": \"https://hmquiz.report-uri.com/a/d/g\" }] }"
  Header always set Reporting-Endpoints "csp-endpoint=\"https://hmquiz.report-uri.com/a/d/g\""

  # STAGING: Report-Only policy (no blocking)
  Header always set Content-Security-Policy-Report-Only "\
default-src 'self'; \
script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com; \
style-src 'self' https://fonts.googleapis.com; \
img-src 'self' data: https://www.google-analytics.com https://stats.g.doubleclick.net https://i.ytimg.com https://secure.gravatar.com https://www.gravatar.com; \
font-src 'self' https://fonts.gstatic.com data:; \
connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com https://stats.g.doubleclick.net https://www.google.com; \
frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; \
worker-src 'self' blob:; prefetch-src 'self'; manifest-src 'self'; \
form-action 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; \
upgrade-insecure-requests; report-to=csp-endpoint"
</IfModule>
# --- /HMQZ ---
