# Production .htaccess â€” allow public traffic
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
# --- HMQZ: staging noindex ---
<IfModule mod_headers.c>
  Header set X-Robots-Tag "noindex, nofollow, noarchive"
</IfModule>
# -----------------------------
# --- HMQZ: CSP Report-Only for STAGING (telemetry only) ---
<IfModule mod_headers.c>
  # Ensure no enforcing CSP on staging
  Header always unset Content-Security-Policy
  Header always unset Content-Security-Policy-Report-Only

  # Reporting endpoints (JSON must be on ONE line; quotes escaped)

  # Report-Only CSP (ONE line, no backslashes/newlines)
</IfModule>
# --- /HMQZ ---

# HMQZ: Staging marker (single line)
<IfModule mod_headers.c>
  Header always set X-HMQZ-Env "staging"
</IfModule>
# HMQZ: legacy CSP report-uri for older browsers
<IfModule mod_headers.c>
</IfModule>
  # HMQZ STAGING reporting (same-origin)
  Header always set Report-To "{"group":"csp-endpoint","max_age":10886400,"endpoints":[{"url":"https://staging.hmquiz.com/csp-collector.php"}]}"
  Header always set Reporting-Endpoints "csp-endpoint="https://staging.hmquiz.com/csp-collector.php""

  # Report-Only CSP (staging): styles tolerant; inline scripts still *reported*; same-origin reporting
  Header always set Content-Security-Policy-Report-Only "default-src 'self'; script-src 'self' https://www.googletagmanager.com https://www.google-analytics.com 'report-sample'; script-src-elem 'self' https://www.googletagmanager.com https://www.google-analytics.com 'report-sample' blob:; script-src-attr 'self' 'report-sample'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline' 'report-sample'; style-src-elem 'self' https://fonts.googleapis.com 'unsafe-inline' 'report-sample'; style-src-attr 'self' 'unsafe-hashes' 'unsafe-inline' 'report-sample'; img-src 'self' data: https://www.google-analytics.com https://stats.g.doubleclick.net https://i.ytimg.com https://secure.gravatar.com https://www.gravatar.com; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net data:; connect-src 'self' https://www.google-analytics.com https://region1.google-analytics.com https://stats.g.doubleclick.net https://www.google.com; frame-src 'self' https://www.youtube.com https://www.youtube-nocookie.com; worker-src 'self' blob:; prefetch-src 'self'; manifest-src 'self'; form-action 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'self'; upgrade-insecure-requests; report-to=csp-endpoint; report-uri https://staging.hmquiz.com/csp-collector.php"
